Chapter 4
143
Querying the data warehouse
The first thing to notice is that a step is a Python function decorated with @step, similar to how 
a ZenML pipeline works. The function below takes as input a list of authors’ full names and per-
forms the following core steps:
•	
It attempts to get or create a UserDocument instance using the first and last names, ap-
pending this instance to the authors list. If the user doesn’t exist, it throws an error.
•	
It fetches all the raw data for the user from the data warehouse and extends the documents 
list to include these user documents.
•	
Ultimately, it computes a descriptive metadata dictionary logged and tracked in ZenML.
… # other imports
from zenml import get_step_context, step
@step
def query_data_warehouse(
    author_full_names: list[str],
) -> Annotated[list, "raw_documents"]:
    documents = []
    authors = []
    for author_full_name in author_full_names:
        logger.info(f"Querying data warehouse for user: {author_full_
name}")
        first_name, last_name = utils.split_user_full_name(author_full_
name)
        logger.info(f"First name: {first_name}, Last name: {last_name}")
        user = UserDocument.get_or_create(first_name=first_name, last_
name=last_name)
        authors.append(user)
        results = fetch_all_data(user)
        user_documents = [doc for query_result in results.values() for doc 
in query_result]
        documents.extend(user_documents)
    step_context = get_step_context()
