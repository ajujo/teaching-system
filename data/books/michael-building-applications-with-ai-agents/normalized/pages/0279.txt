Integration improvements
Ensuring tools output reliable, actionable results for the agent's needs
DSPy supports tool refinement by optimizing how tools are selected and chained
within agent modules. Extending the previous example, suppose feedback reveals a
gap in the toolset for incident triage (e.g., the agent often skips classification steps,
leading to suboptimal decisions). We can add a new mock tool for triage, update the
ReAct module to include it, expand the trainset with examples emphasizing proper
tool chaining, and reoptimize. This improves tool selection heuristics and integration,
making the agent more robust to real-world variability. Here's the extended DSPy
code:
import dspy
dspy.configure(lm=dspy.LM("openai/gpt-4o-mini"))
# Define a DSPy signature for the threat classification task
class ThreatClassifier(dspy.Signature):
   """Classify the threat level of a given indicator (e.g., IP, URL, hash) as
   'benign', 'suspicious', or 'malicious'."""
   indicator: str = dspy.InputField(desc="The indicator to classify, such as an
   IP address, URL, or file hash.")
   threat_level: str = dspy.OutputField(desc="The classified threat level:
   'benign', 'suspicious', or 'malicious'.")
# A DSPy module using ChainOfThought for reasoned classification
class ThreatClassificationModule(dspy.Module):
   def __init__(self):
       super().__init__()
       self.classify = dspy.ChainOfThought(ThreatClassifier)

   def forward(self, indicator):
       return self.classify(indicator=indicator)
# Synthetic/hand-annotated dataset for optimization (in practice, use 50-200+
# examples from real SOC logs)
# Each example includes an indicator and the ground-truth threat level
trainset = [
   dspy.Example(indicator="203.0.113.45",
       threat_level="suspicious").with_inputs('indicator'),  # Known malicious IP
   dspy.Example(indicator="example.com/malware.exe",
       threat_level="malicious").with_inputs('indicator'),  # Malicious URL
   dspy.Example(indicator="benign-site.net",
       threat_level="benign").with_inputs('indicator'),  # Safe domain
   dspy.Example(indicator="abc123def456",
       threat_level="malicious").with_inputs('indicator'),  # Malware hash
   dspy.Example(indicator="192.168.1.1",
       threat_level="benign").with_inputs('indicator'),  # Local IP
   dspy.Example(indicator="obfuscated.url/with?params",
       threat_level="suspicious").with_inputs('indicator'),
   # Edge case: obfuscated URL
Feedback Pipelines
|
257
