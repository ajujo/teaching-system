Figure 7-2. Reflexion agent.
Despite the significant improvement that Reflexion can add to agents, this approach
can be implemented with just a few lines of code:
from typing import Annotated, List, Dict
from typing_extensions import TypedDict
from langchain_openai import ChatOpenAI
from langgraph.graph import StateGraph, MessagesState, START
from langchain_core.messages import HumanMessage
llm = ChatOpenAI(model="gpt-5")
reflections = []
def call_model(state: MessagesState):
   response = llm.invoke(state["messages"])
   return {"messages": response}
reflexion_prompt = f"""You will be given the history of a past experience in 
which you were placed in an environment and given a task to complete. You 
were unsuccessful in completing the task. Do not summarize your environment, 
but rather think about the strategy and path you took to attempt to complete 
the task. Devise a concise, new plan of action that accounts for your mistake 
with reference to specific actions that you should have taken. For example, 
if you tried A and B but  forgot C, then devise a plan to achieve C with 
environment-specific actions. You will need this later when you are solving 
the same task. Give your plan after "Plan".
Instruction:
I am looking for dairy-free and apple variety packs of chips, with a price 
lower than 30.00 dollars
[Search]
Action: search[dairy free and apple variety pack of chips]
138 
| 
Chapter 7: Learning in Agentic Systems
